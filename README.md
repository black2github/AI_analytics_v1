# üîç AI Requirements Analyzer (RAG + Confluence + LangChain + WireGuard)

FastAPI-—Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ Retrieval-Augmented Generation (RAG). –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Confluence, ChromaDB –∏ WireGuard.

---

## üì¶ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* üìÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ø–æ `pageId` –∏–∑ Confluence
* üîç –ê–Ω–∞–ª–∏–∑ –Ω–æ–≤—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
* üß† –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI GPT –∏ Anthropic Claude
* üîó LangChain RAG-–ø–∞–π–ø–ª–∞–π–Ω –Ω–∞ –±–∞–∑–µ ChromaDB
* üß≥ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ WireGuard –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
* üöÄ REST API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/black2github/AI_analytics_v1.git
cd AI_analytics_v1
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env`

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞:

```bash
cp .env.example .env
```

–ò–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –≤–∞—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

### 3. –°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```bash
docker compose up --build
```

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è             | –û–ø–∏—Å–∞–Ω–∏–µ                                                           |
| ---------------------- | ------------------------------------------------------------------ |
| `OPENAI_API_KEY`       | –ö–ª—é—á OpenAI API –¥–ª—è GPT                                            |
| `CLAUDE_API_KEY`       | –ö–ª—é—á Anthropic Claude API                                          |
| `CONFLUENCE_BASE_URL`  | –ë–∞–∑–æ–≤—ã–π URL Confluence (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://confluence.gboteam.ru`) |
| `CONFLUENCE_USER`      | Email Atlassian-–∞–∫–∫–∞—É–Ω—Ç–∞                                           |
| `CONFLUENCE_API_TOKEN` | API-—Ç–æ–∫–µ–Ω Atlassian –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Confluence                       |

> üîê [–°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω Atlassian](https://id.atlassian.com/manage/api-tokens)

---

## üß≠ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ config.py                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ —á—Ç–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ confluence_loader.py      # –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏–∑ Confluence –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º pageId
‚îÇ   ‚îú‚îÄ‚îÄ embedding_store.py        # –†–∞–±–æ—Ç–∞ —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º Chroma (—Å–æ–∑–¥–∞–Ω–∏–µ, –∑–∞–≥—Ä—É–∑–∫–∞, –ø–æ–∏—Å–∫)
‚îÇ   ‚îú‚îÄ‚îÄ llm_interfaces.py         # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å LLM (OpenAI GPT, Claude)
‚îÇ   ‚îú‚îÄ‚îÄ rag_pipeline.py           # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ü–µ–ø–æ—á–∫–∏ RAG: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞, –≤—ã–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –≤—ã–∑–æ–≤ LLM
‚îÇ   ‚îî‚îÄ‚îÄ main.py                   # FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –º–∞—Ä—à—Ä—É—Ç—ã REST API
‚îú‚îÄ‚îÄ chroma_db/                    # –ö–∞—Ç–∞–ª–æ–≥ —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º Chroma (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ requirements.txt              # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python-–ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ Dockerfile                    # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–±–æ—Ä–∫–∏ Docker-–æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ .dockerignore                 # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Docker-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
‚îú‚îÄ‚îÄ docker-compose.yml           # –ö–æ–º–ø–æ–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –≤–∫–ª—é—á–∞—è WireGuard
‚îú‚îÄ‚îÄ .env                          # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ª–æ–∫–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ .env.example                  # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md                     # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

```
üìÑ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

üìÅ app/
__init__.py: –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é app/ –∫–∞–∫ –º–æ–¥—É–ª—å Python. –û–±—ã—á–Ω–æ –ø—É—Å—Ç–æ–π, –Ω–æ –Ω—É–∂–µ–Ω –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞.
config.py: –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Pydantic. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–º–∏ —á–∞—Å—Ç—è–º–∏ –ø—Ä–æ–µ–∫—Ç–∞.
confluence_loader.py: —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API Confluence –∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ pageId. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü.
embedding_store.py: —Å–æ–∑–¥–∞—ë—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º Chroma DB, –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∏—â–µ—Ç –ø–æ—Ö–æ–∂–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –≤–µ–∫—Ç–æ—Ä—É.
llm_interfaces.py: –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è –≤—ã–∑–æ–≤–∞ –º–æ–¥–µ–ª–µ–π OpenAI –∏ Claude. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å LLM.
rag_pipeline.py: –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç —Ü–µ–ø–æ—á–∫—É RAG: –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ Chroma, —Å–±–æ—Ä–∫–∞ –ø—Ä–æ–º–ø—Ç–∞, –≤—ã–∑–æ–≤ LLM –∏ –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
main.py: —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –º–∞—Ä—à—Ä—É—Ç—ã /analyze, /load_platform, /load_service.

üìÅ chroma_db/
–°–æ–¥–µ—Ä–∂–∏—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Chroma ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è.

üìÑ –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
Dockerfile: —Å–æ–∑–¥–∞—ë—Ç –æ–±—Ä–∞–∑, –≤–∫–ª—é—á–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫—É Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ WireGuard, –∑–∞–ø—É—Å–∫ FastAPI.
.dockerignore: –∏—Å–∫–ª—é—á–∞–µ—Ç –ª–∏—à–Ω–∏–µ —Ñ–∞–π–ª—ã –∏–∑ Docker-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, .env, __pycache__, *.log).
docker-compose.yml: –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Å–µ—Ä–≤–∏—Å–æ–º –∏ WireGuard, –º–æ–Ω—Ç–∏—Ä—É–µ—Ç .env, –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç—ã.
.env: —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π).
.env.example: —à–∞–±–ª–æ–Ω –¥–ª—è .env, —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –Ω—É–∂–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.
requirements.txt: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python (LangChain, FastAPI, Chroma, OpenAI SDK –∏ –¥—Ä.).
README.md: –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏—è, API-–º–∞—Ä—à—Ä—É—Ç–∞–º, –∑–∞–ø—É—Å–∫—É –≤ Docker.


---

## üì° REST API

### üîé `POST /analyze`

–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—ã–≤–æ–¥ GPT/Claude.

#### –ó–∞–ø—Ä–æ—Å:

```json
{
  "requirement": "–°–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å SMS –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.",
  "top_k": 3,
  "model": "gpt"
}
```

#### –û—Ç–≤–µ—Ç:

```json
{
  "prompt": "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–µ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ: ...",
  "context": ["...", "..."],
  "analysis": "–≠—Ç–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–∞–µ—Ç ... –ø–æ—Ç–æ–º—É —á—Ç–æ ..."
}
```

---

### üß† `POST /load_platform_context`

–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

```json
{
  "documents": [
    {"id": "auth-1", "text": "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT —Å TTL 30 –º–∏–Ω."},
    {"id": "acl-1", "text": "ACL —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ä–æ–ª–µ–π"}
  ]
}
```

---

### üì• `POST /load_service_pages`

–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü —Å–µ—Ä–≤–∏—Å–∞ –≤ Chroma –ø–æ —Å–ø–∏—Å–∫—É `page_ids`.

```json
{
  "page_ids": [12345678, 87654321]
}
```

---

### üí¨ `POST /analyze_service_pages`

–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏–∑ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö `page_ids` —Å —É—á–µ—Ç–æ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

```json
{
  "page_ids": [12345678, 87654321],
  "model": "claude"
}
```

---

## üõ°Ô∏è WireGuard

WireGuard –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:

* –£ –≤–∞—Å –µ—Å—Ç—å `.conf` —Ñ–∞–π–ª –¥–ª—è WireGuard –≤ `wg/`
* –û–Ω –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `wg0.conf`

---

## üìë –ü—Ä–∏–º–µ—Ä `.env.example`

```dotenv
OPENAI_API_KEY=sk-...
CLAUDE_API_KEY=sk-ant-...
CONFLUENCE_BASE_URL=https://confluence.gboteam.ru
CONFLUENCE_USER=your.name@example.com
CONFLUENCE_API_TOKEN=your-confluence-token
```

---

## üê≥ Docker-–∫–æ–º–∞–Ω–¥—ã

```bash
# –°–±–æ—Ä–∫–∞
docker compose build

# –ó–∞–ø—É—Å–∫
docker compose up

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker compose down
```

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

* [Atlassian API —Ç–æ–∫–µ–Ω—ã](https://id.atlassian.com/manage/api-tokens)
* [WireGuard –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://www.wireguard.com/)
* [LangChain](https://docs.langchain.com/)

---

## üõ† TODO

* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ FastAPI
* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π —á–µ—Ä–µ–∑ –≤–µ–±
* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

---

